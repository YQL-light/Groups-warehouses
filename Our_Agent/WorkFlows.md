![image-20251020232705765](C:\Users\23733\AppData\Roaming\Typora\typora-user-images\image-20251020232705765.png)



#  ***WeaTrip智能助手业务流描述文档***

 

## ***1. 系统概述与架构设计***

  WeaTrip是一个基于MCP协议的智能天气旅行助手系统，它通过自然语言交互为用户提供精准的天气查询和个性化的旅行建议。整个系统采用分层架构设计，从前端用户界面到后端服务处理形成了完整的业务闭环。

  系统架构包含三个核心组件：前端用户界面、MCP客户端（基于DeepSeek大语言模型）和MCP天气服务服务器。前端界面负责用户交互和内容展示，MCP客户端作为智能决策中枢，负责理解用户意图并协调工具调用，而MCP服务器则专门处理天气数据的获取和格式化。这种设计使得系统具有良好的扩展性和维护性，各组件可以独立升级和优化。

## ***2. 用户界面交互流程***

  用户首先看到的是WeaTrip应用的主界面，这是一个设计简洁的聊天式界面。顶部是应用名称"WeaTrip"，中间区域展示智能助手"小W"的头像和欢迎语："请输入目的地，我将根据当地天气为你生成专属出行计划"。

  界面底部是用户输入区域，包含文本输入框和功能按钮。用户可以通过文本输入框直接输入城市名称或旅行需求，如"想去北京"。同时，用户还可以点击附件按钮（标注为"+"号），在弹出的选项中选择"相机"或"相册"功能。用户消息气泡使用绿色，AI回复使用灰色，这些细节共同保证了良好的视觉体验和阅读舒适度。

## ***3. 智能意图识别与工具选择***

  当用户输入查询后，MCP客户端开始工作。客户端首先将用户输入和系统提示词组合成消息数组发送给DeepSeek大语言模型。系统提示词明确指示模型作为专业助手，通过调用合适的工具帮助用户解决问题。此时，客户端会同时向MCP服务器查询可用的工具列表，包括`get_weather`（获取当前天气）、`get_forecast`（5天天气预报）和`weather_report`（详细天气报告）。

  DeepSeek模型基于用户查询的内容进行意图分析。如果用户简单询问"北京天气"，模型可能选择`get_weather`工具；如果用户询问"北京未来几天天气"，则可能选择`get_forecast`；如果用户表达"想去北京旅游，需要天气建议"，模型更可能选择`weather_report`工具，因为它能生成包含穿衣建议和活动推荐的详细报告。这个决策过程完全由大语言模型自主完成，体现了系统的智能化特性。

## ***4. 天气数据获取与处理流程***

  一旦工具被选定，MCP客户端会调用相应的工具函数。以`get_weather`为例，客户端向MCP服务器发送工具调用请求，包含城市名称、国家代码等参数。MCP服务器接收到请求后，首先构建符合OpenWeatherMap API要求的URL，包括位置查询参数、API密钥、测量单位和语言。

  服务器通过异步HTTP请求向OpenWeatherMap API发送请求，并设置完善的错误处理机制。如果请求成功，API返回JSON格式的原始天气数据，服务器随后调用`format_weather_data`函数将技术性的JSON数据转换为易于理解的文本格式。这个转换过程提取关键信息如城市名称、国家代码、天气描述、温度、体感温度、湿度和风速，并根据测量单位自动调整温度符号（℃或℉）和风速单位（m/s或mph）。

## ***5. 智能报告生成与旅游建议***

  对于更复杂的需求，当用户请求旅游建议时，系统会调用`weather_report`工具。这个工具不仅返回原始天气数据，还包含提示模板功能。工具内部首先获取基础天气信息，然后使用正则表达式解析关键数据点，最后返回一个结构化数据，包含原始数据、提示模板名称和模板参数。

  MCP客户端识别到这个结构后，会自动调用对应的`weather_prompt`提示模板。这个模板是一个专业的天气报告框架，要求大语言模型扮演气象播报员，根据提供的天气数据生成包含今日天气概况、体感分析、穿衣建议和户外活动推荐的完整报告。DeepSeek模型基于这个模板和具体天气数据，生成自然、专业且贴近生活的最终回复，真正实现从"天气数据"到"旅行建议"的智能转换。

## ***6. 完整的业务闭环与价值交付***

  最终，生成的天气报告或旅行建议通过MCP客户端返回前端界面，以对话气泡的形式展示给用户。整个业务流程从用户输入开始，经过意图识别、工具选择、数据获取、智能分析和内容生成，最终以有价值的旅行建议结束，形成了完整的业务闭环。

  系统最大的价值在于将技术性的天气数据转化为用户真正需要的决策支持信息。用户不需要理解温度、湿度、风速等数据的具体含义，而是直接获得"适合穿什么衣服"、"可以进行什么活动"等实用的旅行建议，真正体现了智能助手的技术价值和应用价值。
